diff --git a/CMakeLists.txt b/CMakeLists.txt
index bc95660..dd211a5 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -69,53 +69,55 @@ find_package(OpenSSL REQUIRED)
 find_package(nlohmann_json REQUIRED)
 
 if (STATIC_DEPENDENCIES)
+
+
     set(MAMBA_DEPENDENCIES_LIBS
-        libcurl.a
-        libssh2.a
+        # libcurl.a
+        # libssh2.a
 
-        libgssapi_krb5.a
-        libkrb5.a
-        libk5crypto.a
-        libkrb5support.a
-        libcom_err.a
+        # libgssapi_krb5.a
+        # libkrb5.a
+        # libk5crypto.a
+        # libkrb5support.a
+        # libcom_err.a
 
-        libssl.a
-        libcrypto.a
+        # libssl.a
+        # libcrypto.a
 
-        libarchive.a
+        # libarchive.a
 
-        libiconv.a
-        libbz2.a
-        liblz4.a
-        libzstd.a
-        libz.a
-        liblzma.a
-        liblzo2.a
+        # libiconv.a
+        # libbz2.a
+        # liblz4.a
+        # libzstd.a
+        # libz.a
+        # liblzma.a
+        # liblzo2.a
 
-        libsolv.a
-        libsolvext.a
+        # libsolv.a
+        # libsolvext.a
 
-        libnghttp2.a
+        # libnghttp2.a
     )
 
-    if (APPLE)
-        set (MAMBA_FORCE_DYNAMIC_LIBS resolv)
-        set(FINAL_LIBS "")
-        foreach(LIB ${MAMBA_DEPENDENCIES_LIBS})
-            set(TMP_LIB "TMP_LIB-NOTFOUND")
-            find_library(TMP_LIB "${LIB}")
-            list(APPEND FINAL_LIBS "${TMP_LIB}")
-        endforeach(LIB)
-        set (MAMBA_DEPENDENCIES_LIBS "${FINAL_LIBS}")
-    elseif (UNIX)
-        set(MAMBA_FORCE_DYNAMIC_LIBS rt dl resolv)
-    endif()
-
-    if (APPLE)
-        add_link_options(-static-libstdc++)
-    elseif (UNIX)
-        add_link_options(-static-libstdc++ -static-libgcc)
-    endif ()
+    # if (APPLE)
+    #     set (MAMBA_FORCE_DYNAMIC_LIBS resolv)
+    #     set(FINAL_LIBS "")
+    #     foreach(LIB ${MAMBA_DEPENDENCIES_LIBS})
+    #         set(TMP_LIB "TMP_LIB-NOTFOUND")
+    #         find_library(TMP_LIB "${LIB}")
+    #         list(APPEND FINAL_LIBS "${TMP_LIB}")
+    #     endforeach(LIB)
+    #     set (MAMBA_DEPENDENCIES_LIBS "${FINAL_LIBS}")
+    # elseif (UNIX)
+    #     set(MAMBA_FORCE_DYNAMIC_LIBS rt dl resolv)
+    # endif()
+
+    # if (APPLE)
+    #     add_link_options(-static-libstdc++)
+    # elseif (UNIX)
+    #     add_link_options(-static-libstdc++ -static-libgcc)
+    # endif ()
 else ()
     set(MAMBA_DEPENDENCIES_LIBS
         ${LIBSOLV_LIBRARIES}
@@ -248,11 +250,11 @@ endmacro()
 
 set(mamba_targets "")
 
-if (BUILD_SHARED)
-    message(STATUS "BUILDING SHARED")
-    mamba_create_target(mamba SHARED mamba)
-    list(APPEND mamba_targets mamba)
-endif ()
+# if (BUILD_SHARED)
+#     message(STATUS "BUILDING SHARED")
+#     mamba_create_target(mamba SHARED mamba)
+#     list(APPEND mamba_targets mamba)
+# endif ()
 
 if (BUILD_STATIC)
     message(STATUS "BUILDING STATIC")
@@ -286,6 +288,32 @@ if (BUILD_EXE)
 
     add_executable(micromamba ${MAMBA_EXE})
     target_link_libraries(micromamba PUBLIC mamba-static)
+
+    find_package(LibArchive REQUIRED)
+    find_package(CURL CONFIG REQUIRED)
+    find_package(yaml-cpp CONFIG REQUIRED)
+    find_package(nlohmann_json CONFIG REQUIRED)
+    find_package(LibLZMA CONFIG REQUIRED)
+    find_library(LZ4_LIBRARY NAMES lz4)
+    find_library(LZO2_LIBRARY NAMES lzo2)
+    find_package(zstd CONFIG REQUIRED)
+    find_library(LIBSOLV_LIBRARIES NAMES solv)
+    find_library(BZIP2_LIBRARIES NAMES bz2)
+    find_library(LIBSOLVEXT_LIBRARIES NAMES solvext)
+
+    target_link_libraries(micromamba PRIVATE 
+        ${LibArchive_LIBRARY}
+        libzstd
+        ${LZ4_LIBRARY}
+        ${LZO2_LIBRARY}
+        ${BZIP2_LIBRARIES}
+        ${LIBLZMA_LIBRARIES}
+        CURL::libcurl
+        nlohmann_json
+        nlohmann_json::nlohmann_json
+        yaml-cpp
+    )
+
     set_property(TARGET micromamba PROPERTY CXX_STANDARD 17)
 
     install(TARGETS micromamba)
